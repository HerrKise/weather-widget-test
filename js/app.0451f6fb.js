(function(){"use strict";var t={8348:function(t,e,i){var n=i(9242),o=i(3396);const r={class:"widget"},s={key:0},c={key:0,class:"widget__settings"},a={key:1};function l(t,e,i,n,l,u){const d=(0,o.up)("b-icon-x-lg"),g=(0,o.up)("b-icon-gear"),p=(0,o.up)("Settings"),h=(0,o.up)("Main");return(0,o.wg)(),(0,o.iD)("div",r,[(0,o._)("button",{onClick:e[0]||(e[0]=(...t)=>u.toggleSettings&&u.toggleSettings(...t)),class:"settings__btn"},[l.settingsVisible?((0,o.wg)(),(0,o.j4)(d,{key:0,type:"button",class:"icon"})):((0,o.wg)(),(0,o.j4)(g,{key:1,type:"button",class:"icon"}))]),n.isCitiesLoading?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",s,[l.settingsVisible?((0,o.wg)(),(0,o.iD)("div",c,[(0,o.Wm)(p,{onCreate:u.createCity,cities:n.cities,onRemove:u.removeCity,onReorder:u.reorderCities},null,8,["onCreate","cities","onRemove","onReorder"])])):((0,o.wg)(),(0,o.iD)("div",a,[(0,o.Wm)(h,{cities:n.cities},null,8,["cities"])]))]))])}var u=i(7139);const d=(0,o._)("div",{class:"settings__header"},[(0,o._)("h2",null,"Settings")],-1),g={class:"settings_body"},p=["id"],h={class:"city__name"},y={class:"city__button"},f={style:{"margin-left":"5px"}},m=["onClick"],w=(0,o._)("label",{for:"location"},[(0,o._)("h3",null,"Add Location:")],-1),v={style:{display:"flex"}},_={key:0,style:{color:"red"}};function b(t,e,i,r,s,c){const a=(0,o.up)("b-icon-list"),l=(0,o.up)("b-icon-trash"),b=(0,o.up)("b-icon-arrow-return-left");return(0,o.wg)(),(0,o.iD)("div",null,[d,(0,o._)("div",g,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.cities,(i=>((0,o.wg)(),(0,o.iD)("div",{class:"city__settings",key:i.id,id:i.id,draggable:"false",onDragover:e[0]||(e[0]=(0,n.iM)(((...e)=>t.toDragOver&&t.toDragOver(...e)),["prevent"])),onDragenter:e[1]||(e[1]=(0,n.iM)((()=>{}),["prevent"])),onDrop:e[2]||(e[2]=(0,n.iM)((t=>c.onDrop(t)),["prevent"]))},[(0,o._)("div",h,[(0,o._)("button",y,[(0,o.Wm)(a,{class:"icon",onMousedown:t=>c.toDrag(i.id),onMouseup:e=>t.toStopDrag(i.id)},null,8,["onMousedown","onMouseup"])]),(0,o._)("div",f,(0,u.zw)(i.name)+", "+(0,u.zw)(i.country),1)]),(0,o._)("button",{onClick:e=>t.$emit("remove",i),class:"city__button"},[(0,o.Wm)(l,{class:"icon"})],8,m)],40,p)))),128))]),w,(0,o._)("div",v,[(0,o.wy)((0,o._)("input",{id:"location",class:"input","onUpdate:modelValue":e[3]||(e[3]=t=>s.searchQuery=t),onKeyup:e[4]||(e[4]=(0,n.D2)(((...t)=>c.upload&&c.upload(...t)),["enter"]))},null,544),[[n.nr,s.searchQuery]]),(0,o._)("button",{onClick:e[5]||(e[5]=(...t)=>c.upload&&c.upload(...t)),class:"enter"},[(0,o.Wm)(b,{class:"icon"})])]),0!==s.errorMessage.length&&0===s.searchQuery.length?((0,o.wg)(),(0,o.iD)("div",_,(0,u.zw)(s.errorMessage),1)):(0,o.kq)("",!0)])}const S={class:"settings__btn"};function k(t,e,i,n,r,s){return(0,o.wg)(),(0,o.iD)("button",S,[(0,o.WI)(t.$slots,"default")])}var D={name:"toggle-settings-button"},C=i(89);const O=(0,C.Z)(D,[["render",k]]);var $=O,M=i(6265),z=i.n(M),L=JSON.parse('{"_":"http://api.openweathermap.org/","J":"b033d0ae7c72d43ce6b8892b39ba72c9"}');const W=z().create({baseURL:L._}),j={get:W.get};var x=j;const q="geo/1.0/direct?",N={get:async t=>{const{data:e}=await x.get(q+`q=${t}&limit=5&appid=${L.J}`);return e}};var E=N;async function I(t){let e;try{return await E.get(t).then((t=>{if(console.log("test",t),0===t.length)throw"Please, enter correct name";console.log(t[0]),e={id:`id${Date.now()}`,name:t[0].name,country:t[0].country,lat:t[0].lat,lon:t[0].lon}})),e}catch(i){return i}}var A={components:{ToggleSettingsButton:$},props:{cities:{type:Array,required:!0}},data(){return{searchQuery:"",draggable:!1,errorMessage:"",city:{name:"",country:""}}},methods:{toDrag(t){document.querySelector(`#${t}`).setAttribute("draggable",!0),document.querySelector(`#${t}`).classList.add("selected")},onDrop(t){const e=document.querySelector(".selected"),i=t.currentTarget,n=e!==i&&i.classList.contains("city__settings");n&&(this.$emit("reorder",e.id,i.id),e.classList.remove("selected"),e.setAttribute("draggable",!1),console.log(t.currentTarget))},async upload(){this.errorMessage="",await I(this.searchQuery).then((t=>{if("string"===typeof t)throw t;this.$emit("create",t)})).catch((t=>{this.errorMessage=t})).finally((()=>this.searchQuery=""))}}};const V=(0,C.Z)(A,[["render",b]]);var B=V;function H(t,e,i,n,r,s){const c=(0,o.up)("cities-list");return(0,o.wg)(),(0,o.j4)(c,{cities:i.cities},null,8,["cities"])}const J={key:0};function Q(t,e,i,n,r,s){const c=(0,o.up)("city-item");return i.cities.length>0?((0,o.wg)(),(0,o.iD)("div",J,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.cities,(t=>((0,o.wg)(),(0,o.j4)(c,{key:t.id,city:t},null,8,["city"])))),128))])):(0,o.kq)("",!0)}const T={class:"widget__city"},P={class:"widget__header"},R={class:"widget__body__main"},Z=["src"],F={class:"temperature"},K={class:"widget__body__information"},G={class:"widget__body__params"},U={class:"param"},Y={class:"param"},X={class:"param"},tt={class:"param"};function et(t,e,i,n,r,s){return(0,o.wg)(),(0,o.iD)("div",T,[(0,o._)("div",P,[(0,o._)("h3",null,(0,u.zw)(i.city.name),1)]),(0,o._)("div",R,[(0,o._)("img",{src:`http://openweathermap.org/img/wn/${i.city.icon}@2x.png`},null,8,Z),(0,o._)("div",F,[(0,o._)("h1",null,(0,u.zw)(i.city.temp)+" °C",1)])]),(0,o._)("div",K,[(0,o._)("span",null,"Feels like "+(0,u.zw)(i.city.feels_like)+" °C, "+(0,u.zw)(i.city.description)+". ",1),(0,o._)("span",null,(0,u.zw)(i.city.wind_name)+".",1)]),(0,o._)("div",G,[(0,o._)("div",U,(0,u.zw)(i.city.wind_speed)+" m/s "+(0,u.zw)(i.city.wind_direction),1),(0,o._)("div",Y,(0,u.zw)(i.city.pressure)+"hPa",1),(0,o._)("div",X,"Humidity: "+(0,u.zw)(i.city.humidity)+"%",1),(0,o._)("div",tt,"Visibility "+(0,u.zw)(i.city.visibility)+" km",1)])])}var it={props:{city:{type:Object,required:!0}}};const nt=(0,C.Z)(it,[["render",et]]);var ot=nt,rt={props:{cities:{type:Array,required:!0}},components:{CityItem:ot}};const st=(0,C.Z)(rt,[["render",Q]]);var ct=st,at={components:{ToggleSettingsButton:$,CitiesList:ct},props:{cities:{type:Array,required:!0}},methods:{async loadCoordinates(){try{await axios.get("http://api.openweathermap.org/geo/1.0/direct?q=Moskow&limit=5&appid=b033d0ae7c72d43ce6b8892b39ba72c9").then((({data:t})=>{console.log(t[0]),this.city.name=t[0].name,this.city.lat=t[0].lat,this.city.lon=t[0].lon})),await axios.get(`https://api.openweathermap.org/data/2.5/weather?lat=${this.city.lat}&lon=${this.city.lon}&appid=b033d0ae7c72d43ce6b8892b39ba72c9`).then((({data:t})=>{console.log(t.weather[0].icon),this.icon=`https://openweathermap.org/img/wn/${t.weather[0].icon}@2x.png`}))}catch(t){alert(t)}}}};const lt=(0,C.Z)(at,[["render",H]]);var ut=lt,dt=i(4870);const gt="widget-config";function pt(t){localStorage.setItem(gt,JSON.stringify(t))}function ht(){return JSON.parse(localStorage.getItem(gt))}function yt(){return new Promise((function(t,e){navigator.geolocation.getCurrentPosition(t,e)}))}const ft="geo/1.0/reverse?",mt={get:async(t,e)=>{const{data:i}=await x.get(ft+`lat=${t}&lon=${e}&appid=${L.J}`);return i}};var wt=mt;const vt="data/2.5/weather?",_t={get:async(t,e)=>{const{data:i}=await x.get(vt+`lat=${t}&lon=${e}&appid=${L.J}&units=metric`);return i}};var bt=_t;function St(t){return Math.round(10*t)/10}function kt(t){return t<=1?"Calm":t>1&&t<=2?"Light Air":t>2&&t<=3?"Light breeze":t>3&&t<=4?"Gentle breeze":t>4&&t<=5?"Moderate breeze":t>5&&t<=6?"Fresh breeze":t>6&&t<=7?"Strong breeze":t>7&&t<=8?"Moderate gale":t>8&&t<=9?"Fresh gale":t>9&&t<=10?"Strong gale":t>10&&t<=11?"Storm":t>11&&t<=12?"Violent storm":"Hurricane"}function Dt(t){return t>348.75&&t<=360||t<=11.25?"N":t>11.25&&t<=33.75?"NNE":t>33.75&&t<=56.25?"NE":t>56.25&&t<=78.75?"ENE":t>78.75&&t<=101.25?"E":t>101.25&&t<=123.75?"ESE":t>123.75&&t<=146.25?"SE":t>146.25&&t<=168.75?"SSE":t>168.75&&t<=191.25?"S":t>191.25&&t<=213.75?"SSW":t>213.75&&t<=236.25?"SW":t>236.25&&t<=258.75?"WSW":t>258.75&&t<=281.25?"W":t>281.25&&t<=303.75?"WNW":t>303.75&&t<=326.25?"NW":t>326.25&&t<=348.75?"NNW":void 0}async function Ct(t){let e;try{return await bt.get(t.lat,t.lon).then((i=>{console.log(i),e={id:t.id,name:t.name,country:i.sys.country,icon:i.weather[0].icon,temp:St(i.main.temp),feels_like:St(i.main.feels_like),description:i.weather[0].description,wind_name:kt(i.wind.speed),wind_speed:St(i.wind.speed),wind_direction:Dt(i.wind.deg),pressure:i.main.pressure,humidity:i.main.humidity,visibility:i.visibility/1e3}})),e}catch(i){console.log(i)}}function Ot(){const t=(0,dt.iH)([]),e=(0,dt.iH)([]),i=(0,dt.iH)(!0),n=async()=>{try{if(ht()&&0!==ht().length){t.value=ht();for(const i of t.value)Ct(i).then((t=>e.value.push(t)))}else{console.log("начали");const i=await yt(),n=i.coords.latitude,o=i.coords.longitude;wt.get(n,o).then((i=>{t.value.push({id:`id${Date.now()}`,country:i[0].country,name:i[0].name,lat:i[0].lat,lon:i[0].lon}),pt(t.value);for(const n of t.value)Ct(n).then((t=>e.value.push(t)))}))}console.log("ljikj",t.value)}catch(n){console.log(n)}finally{i.value=!1}};return(0,o.bv)(n),{config:t,cities:e,isCitiesLoading:i}}var $t={data(){return{settingsVisible:!1,searchQuery:""}},setup(){const{cities:t,config:e,isCitiesLoading:i}=Ot();return{cities:t,config:e,isCitiesLoading:i}},methods:{toggleSettings(){this.settingsVisible=!this.settingsVisible},async createCity(t){this.config.push(t),pt(this.config),await Ct(t).then((t=>this.cities.push(t)))},removeCity(t){this.config=this.config.filter((e=>e.id!==t.id)),pt(this.config),this.cities=this.cities.filter((e=>e.id!==t.id))},reorderCities(t,e){const i=this.cities.indexOf(this.cities.find((e=>e.id===t))),n=this.cities.indexOf(this.cities.find((t=>t.id===e)));this.cities.splice(n,0,this.cities.splice(i,1)[0]),this.config.splice(n,0,this.config.splice(i,1)[0]),pt(this.config),console.log(i,n)}},components:{Settings:B,Main:ut}};const Mt=(0,C.Z)($t,[["render",l]]);var zt=Mt,Lt=[$],Wt=i(6060);const jt=(0,n.ri)(zt);Lt.forEach((t=>jt.component(t.name,t))),jt.component("BIconList",Wt.Gbt).component("BIconGear",Wt.ajv).component("BIconXLg",Wt.hOD).component("BIconTrash",Wt.DkS).component("BIconArrowReturnLeft",Wt.nyK).mount("#app")}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,i),r.exports}i.m=t,function(){var t=[];i.O=function(e,n,o,r){if(!n){var s=1/0;for(u=0;u<t.length;u++){n=t[u][0],o=t[u][1],r=t[u][2];for(var c=!0,a=0;a<n.length;a++)(!1&r||s>=r)&&Object.keys(i.O).every((function(t){return i.O[t](n[a])}))?n.splice(a--,1):(c=!1,r<s&&(s=r));if(c){t.splice(u--,1);var l=o();void 0!==l&&(e=l)}}return e}r=r||0;for(var u=t.length;u>0&&t[u-1][2]>r;u--)t[u]=t[u-1];t[u]=[n,o,r]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,n){var o,r,s=n[0],c=n[1],a=n[2],l=0;if(s.some((function(e){return 0!==t[e]}))){for(o in c)i.o(c,o)&&(i.m[o]=c[o]);if(a)var u=a(i)}for(e&&e(n);l<s.length;l++)r=s[l],i.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return i.O(u)},n=self["webpackChunkwidget"]=self["webpackChunkwidget"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(8348)}));n=i.O(n)})();
//# sourceMappingURL=app.0451f6fb.js.map